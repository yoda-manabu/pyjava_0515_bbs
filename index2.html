<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PyJava_0515 掲示板</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body { font-family: "Press Start 2P", monospace; background-color: #111; color: #fefefe; margin:0; padding:0; }
header { background:#222; padding:14px; text-align:center; font-size:18px; color:#0ff; text-shadow:2px 2px #08f; box-shadow:0 3px 8px rgba(0,255,255,0.4); }
.container { max-width:700px; margin:15px auto; padding:15px; background:#1a1a1a; border:3px solid #0ff; border-radius:10px; box-shadow:0 0 10px #0ff; }
h3 { font-size:14px; color:#ff0; text-shadow:1px 1px #f00; margin-bottom:10px; }
input, textarea, select, button { width:100%; padding:10px; margin-bottom:8px; background:#222; color:#0ff; border:2px solid #0ff; border-radius:5px; font-family:"Press Start 2P", monospace; font-size:12px; resize:vertical; box-sizing:border-box; }
textarea { min-height:70px; }
button { background:#0ff; color:#000; cursor:pointer; box-shadow:2px 2px #08f; transition:all 0.2s; }
button:hover { background:#ff0; box-shadow:2px 2px #f80; }
.thread, .reply { border:2px solid #0ff; padding:10px; margin-bottom:10px; background:#111; border-radius:5px; box-shadow:0 0 8px #0ff; }
.thread { cursor:pointer; display:flex; justify-content:space-between; align-items:center; }
.reply { margin-left:20px; border-color:#ff80ff; box-shadow:0 0 6px #ff80ff; }
.delete-btn { color:#f44; cursor:pointer; font-size:10px; margin-left:10px; }
.lucky { margin:10px 0; padding:10px; background:#222; border:2px dashed #0ff; border-radius:5px; box-shadow:0 0 5px #0ff; font-size:12px; }
.welcome { font-size:12px; color:#0ff; text-align:center; margin-bottom:10px; }
#threadView { display:none; }
@media screen and (max-width:600px) {
    body { font-size:10px; }
    .container { width:92%; padding:10px; }
    input, textarea, select, button { font-size:10px; padding:8px; }
    header { font-size:14px; }
    .welcome { font-size:10px; }
}
</style>
</head>
<body>
<header>PyJava_0515 掲示板</header>

<div class="container" id="loginContainer">
    <h3>ログイン</h3>
    <input type="text" id="username" placeholder="ユーザー名">
    <button onclick="login()">ログイン</button>
</div>

<div class="container" id="mainContainer" style="display:none">
    <div class="welcome">ようこそ、<span id="currentUser"></span> さん！</div>

    <!-- 占い -->
    <div>
        <h3>占い</h3>
        <select id="zodiac">
            <option value="">選択してください</option>
            <option value="おうし座">おうし座</option>
            <option value="ふたご座">ふたご座</option>
            <option value="かに座">かに座</option>
            <option value="しし座">しし座</option>
            <option value="おとめ座">おとめ座</option>
            <option value="てんびん座">てんびん座</option>
            <option value="さそり座">さそり座</option>
            <option value="いて座">いて座</option>
            <option value="やぎ座">やぎ座</option>
            <option value="みずがめ座">みずがめ座</option>
            <option value="うお座">うお座</option>
        </select>
        <button onclick="showFortune()">占う</button>
        <div class="lucky" id="fortune"></div>
    </div>

    <!-- スレッド作成 -->
    <h3>スレッド一覧</h3>
    <input type="text" id="title" placeholder="スレッドタイトル">
    <textarea id="threadContent" placeholder="本文を入力してください"></textarea>
    <button onclick="createThread()">新規スレッド作成</button>
    <div id="threads"></div>

    <!-- スレッド詳細 -->
    <div id="threadView">
        <button onclick="backToList()">← スレッド一覧へ戻る</button>
        <h3 id="threadTitle"></h3>
        <p id="threadContentDisplay"></p>
        <div id="replies"></div>
        <textarea id="replyContent" placeholder="返信内容"></textarea>
        <button onclick="addReply()">返信する</button>
    </div>

    <button onclick="resetAll()" style="background:#f44;margin-top:10px;">全データを消す</button>
    <button onclick="logout()" style="background:red;margin-top:10px;">ログアウト</button>
</div>

<script>
const colorCssMap = {
    "レッド":"red","グリーン":"lime","イエロー":"yellow","ブルー":"deepskyblue",
    "オレンジ":"orange","パープル":"violet","ピンク":"hotpink","ブラック":"black",
    "ゴールド":"gold","シルバー":"silver","ブラウン":"brown","ホワイト":"white"
};
const fortunes = [
    "「幸せは、活動の中にある。」 — アリストテレス",
    "「小さなことを大きな愛で行いなさい。」 — マザー・テレサ",
    "「どれほどゆっくり進もうとも、止まりさえしなければ問題ではない。」 — 孔子",
    "「幸せは準備が整った心に訪れる。」 — ダライ・ラマ",
    "「行動は言葉よりも力を持つ。」 — ニーチェ",
    "「過去に縛られず、今を生きよ。」 — 孔子",
    "「幸せは、見つけるものではなく作るもの。」 — アリストテレス",
    "「答えは外にではなく、心の中にある。」 — デカルト",
    "「一歩踏み出す勇気が、世界を変える。」 — カント",
    "「心の平穏は、思考の整理から。」 — スピノザ",
    "「人生は自分で描くものだ。」 — エマーソン",
    "「簡素に生きよ、そうすれば幸福も近くなる。」 — ソロー"
];

let threads = JSON.parse(localStorage.getItem('threads') || '[]');
let currentThreadId = null;
let currentUser = null;
const adminUser = 'yoda';

function saveThreads() { localStorage.setItem('threads', JSON.stringify(threads)); }

function createThread() {
    const title = document.getElementById('title').value.trim();
    const content = document.getElementById('threadContent').value.trim();
    if (!title || !content) return alert('タイトルと本文を入力してください');
    threads.push({ id: Date.now(), title, content, user: currentUser, replies: [] });
    saveThreads();
    document.getElementById('title').value = '';
    document.getElementById('threadContent').value = '';
    renderThreads();
}

function renderThreads() {
    const container = document.getElementById('threads');
    container.innerHTML = '';
    if (threads.length === 0) { container.innerHTML = '<p>スレッドはまだありません。</p>'; return; }
    threads.forEach(t => {
        const div = document.createElement('div');
        div.className = 'thread';
        div.innerHTML = `
            <span><strong>${t.title}</strong> — ${t.user}</span>
            ${(t.user === currentUser || currentUser === adminUser) ? 
                `<span class="delete-btn" onclick="deleteThread(${t.id})">[削除]</span>` : ''}
        `;
        div.onclick = (e) => { if(e.target.classList.contains('delete-btn')) return; openThread(t.id); };
        container.appendChild(div);
    });
}

function deleteThread(threadId) {
    const thread = threads.find(t=>t.id===threadId);
    if (thread.user!==currentUser && currentUser!==adminUser) return alert('権限がありません');
    if (!confirm('このスレッドを本当に削除しますか？')) return;
    threads = threads.filter(t => t.id !== threadId);
    saveThreads();
    renderThreads();
}

function openThread(threadId) {
    currentThreadId = threadId;
    const thread = threads.find(t => t.id === threadId);
    document.getElementById('threadTitle').textContent = thread.title;
    document.getElementById('threadContentDisplay').textContent = thread.content;
    document.getElementById('threadView').style.display = 'block';
    document.getElementById('threads').style.display = 'none';
    renderReplies(thread);
}

function backToList() {
    document.getElementById('threadView').style.display = 'none';
    document.getElementById('threads').style.display = 'block';
    currentThreadId = null;
    renderThreads();
}

function renderReplies(thread) {
    const container = document.getElementById('replies');
    container.innerHTML = '';
    thread.replies.forEach(r => {
        const div = document.createElement('div');
        div.className = 'reply';
        div.innerHTML = `<strong>${r.user}</strong>: ${r.content}
            ${(r.user===currentUser || currentUser===adminUser) ? 
                `<span class="delete-btn" onclick="deleteReply(${r.id})">[削除]</span>` : ''}`;
        container.appendChild(div);
    });
}

function addReply() {
    const input = document.getElementById('replyContent');
    const text = input.value.trim();
    if (!text) return alert('返信内容を入力してください');
    const thread = threads.find(t => t.id === currentThreadId);
    thread.replies.push({ id: Date.now(), content: text, user: currentUser });
    saveThreads();
    input.value = '';
    renderReplies(thread);
}

function deleteReply(replyId) {
    const thread = threads.find(t => t.id === currentThreadId);
    const reply = thread.replies.find(r => r.id===replyId);
    if(reply.user!==currentUser && currentUser!==adminUser) return alert('権限がありません');
    thread.replies = thread.replies.filter(r => r.id !== replyId);
    saveThreads();
    renderReplies(thread);
}

function showFortune() {
    const zodiac = document.getElementById('zodiac').value;
    if (!zodiac) return alert('星座を選んでください');
    const colors = Object.keys(colorCssMap);
    const luckyColor = colors[Math.floor(Math.random() * colors.length)];
    const fortune = fortunes[Math.floor(Math.random() * fortunes.length)];
    document.getElementById('fortune').innerHTML =
        `${zodiac} の今日のラッキーカラー: <span style="color:${colorCssMap[luckyColor]};font-weight:bold;">${luckyColor}</span><br>${fortune}`;
}

function resetAll() {
    if (!confirm('本当にすべてのデータを消去しますか？')) return;
    if(currentUser!==adminUser) return alert('管理者のみ全削除可能です');
    threads=[];
    localStorage.clear();
    renderThreads();
    document.getElementById('replies').innerHTML='';
    alert('すべてのデータを消去しました！');
}

function login() {
    let name = document.getElementById('username').value.trim();
    if(!name) name="名無し";
    currentUser=name;
    document.getElementById('currentUser').textContent=currentUser;
    document.getElementById('loginContainer').style.display='none';
    document.getElementById('mainContainer').style.display='block';
    renderThreads();
}

function logout() {
    currentUser=null;
    document.getElementById('loginContainer').style.display='block';
    document.getElementById('mainContainer').style.display='none';
}
</script>
</body>
</html>
